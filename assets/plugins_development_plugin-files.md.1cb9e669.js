import{_ as a,o as l,c as o,C as s,a as p,t as e,V as t}from"./chunks/framework.30da3c52.js";const m=JSON.parse('{"title":"Files Plugin","description":"","frontmatter":{"title":"Files Plugin"},"headers":[],"relativePath":"plugins/development/plugin-files.md","filePath":"plugins/development/plugin-files.md","lastUpdated":1679093544000}'),r={name:"plugins/development/plugin-files.md"},c={id:"frontmatter-title",tabindex:"-1"},F=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-label":'Permalink to "{{ $frontmatter.title }}"'},"​",-1),C=t(`<p>To add your own FileHandler you have to implement the trait <code>dev.mongocamp.server.plugin.FilePlugin</code>.</p><p>Every MongoCamp Server Instance can have only active File Handler by setting the <a href="./../../config/environment-db.html">Config AUTH_HANDLER</a>.</p><h2 id="sample" tabindex="-1">Sample <a class="header-anchor" href="#sample" aria-label="Permalink to &quot;Sample&quot;">​</a></h2><div class="language-scala"><button title="Copy Code" class="copy"></button><span class="lang">scala</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">server</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">file</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">better</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">files</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">File</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">driver</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongodb</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">{ </span><span style="color:#FFCB6B;">GenericObservable</span><span style="color:#A6ACCD;">, </span><span style="color:#FFCB6B;">_</span><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">server</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">converter</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">MongoCampBsonConverter</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">convertIdField</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">server</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">database</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">MongoDatabase</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">server</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">model</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">BucketInformation</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">GridFsBucketChunksSuffix</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dev</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongocamp</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">server</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">plugin</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">FilePlugin</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">org</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">mongodb</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">scala</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">bson</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">ObjectId</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">GridFsFileAdapter</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">FilePlugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">val</span><span style="color:#A6ACCD;"> name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gridfs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getFile</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">, </span><span style="color:#A6ACCD;font-style:italic;">fileId</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">File</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">object</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">FilesDAO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">extends</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">GridFSDAO</span><span style="color:#A6ACCD;">(</span><span style="color:#FFCB6B;">MongoDatabase</span><span style="color:#A6ACCD;">.databaseProvider, bucket)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">val</span><span style="color:#A6ACCD;"> tmpFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">File</span><span style="color:#A6ACCD;">.newTemporaryFile()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">FilesDAO</span><span style="color:#A6ACCD;">.downloadFileResult(convertIdField(fileId), tmpFile)</span></span>
<span class="line"><span style="color:#A6ACCD;">    tmpFile</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">putFile</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">, </span><span style="color:#A6ACCD;font-style:italic;">fileId</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">, </span><span style="color:#A6ACCD;font-style:italic;">file</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">File</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">???</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">size</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Double</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">MongoDatabase</span><span style="color:#A6ACCD;">.databaseProvider.dao(</span><span style="color:#89DDFF;">s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bucket</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GridFsBucketChunksSuffix</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">).collectionStatus.result().size</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">delete</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Unit</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">MongoDatabase</span><span style="color:#A6ACCD;">.databaseProvider.dao(</span><span style="color:#89DDFF;">s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bucket</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GridFsBucketChunksSuffix</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">).drop().result()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">clear</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">MongoDatabase</span><span style="color:#A6ACCD;">.databaseProvider.dao(</span><span style="color:#89DDFF;">s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bucket</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GridFsBucketChunksSuffix</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">).deleteAll().result().wasAcknowledged()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">override</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">deleteFile</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">bucket</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">, </span><span style="color:#A6ACCD;font-style:italic;">fileId</span><span style="color:#A6ACCD;">: </span><span style="color:#FFCB6B;">String</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">val</span><span style="color:#A6ACCD;"> deleteResult </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MongoDatabase</span><span style="color:#A6ACCD;">.databaseProvider.dao(</span><span style="color:#89DDFF;">s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">bucket</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">GridFsBucketChunksSuffix</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">).deleteMany(</span><span style="color:#FFCB6B;">Map</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">files_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ObjectId</span><span style="color:#A6ACCD;">(fileId))).result()</span></span>
<span class="line"><span style="color:#A6ACCD;">    deleteResult.wasAcknowledged() </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> deleteResult.getDeletedCount </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,4);function D(n,y,A,i,B,d){return l(),o("div",null,[s("h1",c,[p(e(n.$frontmatter.title)+" ",1),F]),C])}const g=a(r,[["render",D]]);export{m as __pageData,g as default};
